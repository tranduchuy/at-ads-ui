<div class="container">

  <div class="main-title" fxLayout="row" fxLayout.xs="column">
    <div class="parent-title">CÔNG CỤ KHÁCH HÀNG
      <mat-icon>arrow_forward_ios</mat-icon>
    </div>
    <div class="subtitle">CẤU HÌNH GỬI THÔNG TIN TƯ VẤN - WEBSITE
      <span class="selected-website">
        {{(websiteCtrl.value.name || '') | uppercase}}
      </span>
    </div>
  </div>

  <div class="inner" *ngIf="isProcessing === false">

    <div class="no-website-notify" *ngIf="hasWebsite === false">
      Không tìm thấy website nào.
    </div>

    <div *ngIf="hasWebsite === true">
      <mat-form-field class="website-selection">
        <mat-label>Lựa chọn website</mat-label>
        <mat-select [formControl]="websiteCtrl" #singleSelect (selectionChange)="selectWebsite()"
          [disabled]="isProcessing === true">
          <mat-option>
            <ngx-mat-select-search [formControl]="websiteFilterCtrl" [placeholderLabel]="'Tìm kiếm'"
              [noEntriesFoundLabel]="'Không tìm thấy website nào'"></ngx-mat-select-search>
          </mat-option>
          <mat-option *ngFor="let website of filteredWebsites | async" [value]="website">
            {{website.name}}
          </mat-option>
        </mat-select>
      </mat-form-field>

      <div class="popup-config">
        <div fxLayout="row" fxLayoutGap="30px" fxLayout.xs="column" fxLayoutGap.xs="0">
          <div class="tabs" fxFlex="50">
            <mat-tab-group mat-stretch-tabs class="example-stretched-tabs mat-elevation-z4">
              <mat-tab label="1. Nội dung popup">
                <div class="tab-content popup-style">
                  <form [formGroup]="popupStyleForm" (ngSubmit)="submitPopupStyleForm()">
                    <div class="theme-color-selection">
                      <mat-label style="color: gray">
                        <mat-icon>palette</mat-icon>
                        Màu sắc chủ đề
                      </mat-label>
                      <div class="form-control select-color-panel">
                        <color-circle [color]="popupStyleForm.controls['themeColor'].value"
                          (onChangeComplete)="selectColorCircle($event)" circleSize="15" width="100%">
                        </color-circle>
                      </div>
                    </div>
                    <div class="background-image-selection">
                      <p class="background-image-selection-title">
                        <mat-icon>headset_mic</mat-icon>
                        Thông tin người tư vấn
                      </p>
                      <div class="supporter-details">
                        <mat-form-field class="example-full-width" class="popup-style-form-field">
                          <input matInput placeholder="Họ và tên" formControlName="supporterName" maxlength="30">
                        </mat-form-field>
                        <div *ngIf="supporterName.invalid && (supporterName.dirty || supporterName.touch)"
                          class="errors">
                          <div *ngIf="supporterName.errors.required">
                            Bắt buộc
                          </div>
                        </div>
                        <div fxLayout="row" fxLayoutGap="15px" class="popup-style-form-field">
                          <mat-form-field class="example-full-width" fxFlex="65">
                            <input matInput placeholder="Chuyên môn" formControlName="supporterMajor" maxlength="30">
                          </mat-form-field>
                          <div fxFlex="35">
                            <mat-form-field class="example-full-width">
                              <input matInput placeholder="Số điện thoại" formControlName="supporterPhone"
                                maxlength="10">
                            </mat-form-field>
                            <div *ngIf="supporterPhone.invalid && (supporterPhone.dirty || supporterPhone.touch)"
                              class="errors">
                              <div *ngIf="supporterPhone.errors.required">
                                Bắt buộc
                              </div>
                              <div *ngIf="supporterPhone.errors.invalidPhoneNumber">
                                Số điện thoại không hợp lệ
                              </div>
                            </div>
                          </div>
                        </div>

                      </div>
                      <div class="background-image-selection-storage">
                        <mat-label style="color: gray; font-size: 12px">Ảnh đại diện</mat-label>
                        <div class="form-control" fxLayout="row wrap" fxLayoutGap="grid">
                          <img src="{{url}}" alt="" *ngFor="let url of images" (click)="selectSupporterAvatar(url)">
                        </div>
                      </div>
                    </div>
                  </form>
                  <div class="submit-area">
                    <button mat-raised-button color="accent" (click)="submitPopupStyleForm(false)">
                      Lưu cấu hình
                    </button>
                  </div>
                </div>
              </mat-tab>
              <mat-tab label="2. Cài đặt hiển thị">
                <div class="tab-content popup-display">
                  <div class="enable-display">
                    <mat-slide-toggle [color]="popupDisplayEnableSlideToggle.color"
                      [checked]="popupDisplayEnableSlideToggle.checked"
                      [disabled]="popupDisplayEnableSlideToggle.disabled"
                      (change)="onCheckPopupDisplayEnableSlideToggle($event)">
                      {{popupDisplayEnableSlideToggle.label}}
                    </mat-slide-toggle>
                  </div>

                  <div class="customize-open-popup-button-position" *ngIf="popupDisplayEnableSlideToggle.checked">
                    <mat-label style="color: gray; font-size: 12px">Vị trí nút mở popup</mat-label>
                    <div class="selection">
                      <mat-radio-group fxLayout="row wrap" fxLayoutGap="10px grid"
                        (change)="changeOpenPopupButtonPosition($event)">
                        <mat-radio-button *ngFor="let item of openPopupButtonPositions" [value]="item.value"
                          [checked]="item.checked">
                          {{item.name}}
                        </mat-radio-button>
                      </mat-radio-group>
                    </div>
                  </div>

                  <div class="auto-display-popup">
                    <div class="enable-toggle">
                      <mat-slide-toggle [color]="autoDisplayPopupSlideToggle.color"
                        [checked]="autoDisplayPopupSlideToggle.checked"
                        [disabled]="autoDisplayPopupSlideToggle.disabled"
                        (change)="onCheckAutoDisplayPopupSlideToggle($event)">
                        {{autoDisplayPopupSlideToggle.label}}
                      </mat-slide-toggle>
                    </div>
                    <div class="time-selection" *ngIf="autoDisplayPopupSlideToggle.checked">
                      <mat-radio-group fxLayout="row" fxLayout.xs="column" fxLayoutGap="20px"
                        (change)="changeAutoDisplayPopupTime($event)">
                        <mat-radio-button *ngFor="let item of autoDisplayPopupTimeOptions" [value]="item.value"
                          [checked]="item.checked">
                          {{item.name}}
                        </mat-radio-button>
                      </mat-radio-group>
                    </div>
                  </div>

                  <!-- <div class="display-popup-before-exit-page">
                    <mat-slide-toggle [color]="displayPopupBeforeExitPageToggle.color"
                      [checked]="displayPopupBeforeExitPageToggle.checked"
                      [disabled]="displayPopupBeforeExitPageToggle.disabled"
                      (change)="onCheckDisplayPopupBeforeExitPageToggle($event)">
                      {{displayPopupBeforeExitPageToggle.label}}
                    </mat-slide-toggle>
                  </div> -->

                </div>
              </mat-tab>
              <!-- <mat-tab label="3. Nội dung thành công" [disabled]="true">
                <div class="tab-content popup-done">
                  Chúng tôi đang xây dựng chức năng này.
                </div>
              </mat-tab> -->
            </mat-tab-group>
          </div>

          <div class="popup-example" fxFlex="50" fxLayout="column" fxLayoutGap="20px">
            <div class="browser-container">
              <div class="browser" fxLayout="column">
                <div class="website-domain">
                  <a href="{{websiteCtrl.value.name}}" target="_blank"
                    matTooltip="Nhấn để truy cập website của bạn">{{websiteCtrl.value.name}}</a>
                </div>
                <div class="popup">
                  <div class="header">
                    <span>x</span>
                  </div>
                  <div class="content">
                    <div fxLayout="row">
                      <div class="info" fxFlex="60">
                        <div class="title" [style.color]="popupStyleForm.controls['themeColor'].value">Trợ giúp qua điện
                          thoại
                        </div>
                        <div class="notice">
                          Vui lòng nhập họ tên, số điện thoại và email của bạn, chúng tôi sẽ gọi lại bạn ngay. Hoặc bạn
                          có
                          thể <span [style.color]="popupStyleForm.controls['themeColor'].value">nhấn vào đây</span> để
                          gọi
                          trực tiếp cho chúng tôi.
                        </div>
                        <div class="input">Họ và tên</div>
                        <div class="input">Số điện thoại</div>
                        <div class="input">Địa chỉ email</div>
                        <p class="button" [style.background]="popupStyleForm.controls['themeColor'].value">Gửi yêu cầu
                        </p>
                      </div>
                      <div class="background-img" fxFlex="40">
                        <div class="supporter-avatar" [style.background-image]="'url(' + popupStyleForm.controls['supporterAvatar'].value + ')'"></div>
                        <div class="supporter-name">{{popupStyleForm.controls['supporterName'].value || ''}}</div>
                        <div class="supporter-major">{{popupStyleForm.controls['supporterMajor'].value || ''}}</div>
                        <div class="supporter-phone">
                          <img src="https://ducanhduhoc.vn/wp-content/themes/zen/asset/img/phone-flat.png" alt=""
                            class="phone-icon">
                          <span class="phone-number">{{popupStyleForm.controls['supporterPhone'].value || ''}}</span>
                        </div>
                      </div>
                    </div>
                    <div class="footer">
                      <img src="https://image.flaticon.com/icons/png/128/222/222506.png" alt="">
                      <span>x2.com.vn</span>
                    </div>
                  </div>
                </div>
                <div class="open-popup-button-wrapper">
                  <div class="open-popup-button" *ngIf="popupDisplayEnableSlideToggle.checked"
                    [class.bottom-left]="openPopupButtonPositionStyle === 1"
                    [class.bottom-right]="openPopupButtonPositionStyle === 2"
                    [class.center-right]="openPopupButtonPositionStyle === 3"
                    [class.center-left]="openPopupButtonPositionStyle === 4"
                    [class.top-left]="openPopupButtonPositionStyle === 5"
                    [class.top-right]="openPopupButtonPositionStyle === 6"
                    [ngStyle]="{'background-image': 'url(' + popupStyleForm.controls['supporterAvatar'].value + ')'}">
                    <div class="say-hello-label">Hi</div>
                  </div>
                </div>
              </div>
            </div>

          </div>
        </div>

      </div>
    </div>
  </div>

</div>