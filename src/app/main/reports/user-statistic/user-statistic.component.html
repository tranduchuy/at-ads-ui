<div class="container">

  <div class="title1" fxLayout="row" fxLayout.xs="column">
    <p class="title2" fxFlex="80">BÁO CÁO NGƯỜI DÙNG CLICK QUẢNG CÁO - TÀI KHOẢN <span
        class="adsId">{{sessionService.activeAdsAccountId}}</span></p>
    <mat-form-field class="datePicker" fxFlex="20">
      <mat-label style="color: white; font-weight: bold">Khoảng thời gian thống kê</mat-label>
      <input type="text" ngxDaterangepickerMd matInput readonly [locale]="locale" [(ngModel)]="selectedDateRange"
        startKey="start" endKey="end" [material]="true" [ranges]="ranges" (datesUpdated)="onSelectDateRange($event)"
        (change)="onApplyDateRange()" ngDefaultControl />
    </mat-form-field>
  </div>

  <div class="inner">
    <div class="mat-elevation-z8 table-wrapper">
      <mat-table
        [dataSource]="dataSource | paginate: { itemsPerPage: pageLimit, currentPage: currentPageNumber, totalItems: totalItems }">

        <ng-container matColumnDef="time">
          <mat-header-cell *matHeaderCellDef> Thời gian </mat-header-cell>
          <mat-cell *matCellDef="let element"> {{element.createdAt | date: 'HH:mm dd/MM/yyyy'}} </mat-cell>
        </ng-container>

        <ng-container matColumnDef="uuid">
          <mat-header-cell *matHeaderCellDef> Người dùng (uid) </mat-header-cell>
          <mat-cell *matCellDef="let element">
            <a mat-button color="accent" *ngIf="element.uuid" class="uuid-detail-link"
              matTooltip="Nhấn vào để xem chi tiết"
              [routerLink]="['/bao-cao/chi-tiet-thong-ke-nguoi-dung', element.uuid, router.url]">
              <div fxLayout="row" fxLayoutGap="8px" fxLayoutAlign="start center">
                <ngx-avatar size="24" name="{{element.customerInfo.name.split(' ').slice(-1)[0]}}"
                  *ngIf="element.customerInfo?.name">
                </ngx-avatar>
                <ngx-avatar size="24" src="../../../../assets/icons/blank-avatar.png"
                  *ngIf="!element.customerInfo?.name"></ngx-avatar>
                <span
                  *ngIf="element.customerInfo?.phoneNumber">{{numberWithSpaces(element.customerInfo.phoneNumber, '### ### ####')}}</span>
                <span *ngIf="!element.customerInfo?.phoneNumber && element.uuid">*{{element.uuid.slice(-12)}}*</span>
              </div>
            </a>
            <div *ngIf="!element.customerInfo?.phoneNumber && !element.uuid" fxLayout="row" fxLayoutGap="8px"
              fxLayoutAlign="start center">
              <ngx-avatar size="24" src="../../../../assets/icons/blank-avatar.png">
              </ngx-avatar>
              <span style="color:silver; font-weight: bold">Unknown</span>
            </div>
          </mat-cell>
        </ng-container>

        <ng-container matColumnDef="clicks">
          <mat-header-cell *matHeaderCellDef> Số click </mat-header-cell>
          <mat-cell *matCellDef="let element"> {{element.count}} </mat-cell>
        </ng-container>

        <ng-container matColumnDef="isPrivateBrowsing">
          <mat-header-cell *matHeaderCellDef>Ẩn danh</mat-header-cell>
          <mat-cell *matCellDef="let element">
            <span *ngIf="element.isPrivateBrowsing === true" style="color: orange; font-weight: bold">
              <mat-icon>report_problem</mat-icon>Có
            </span>
            <span *ngIf="element.isPrivateBrowsing === false" style="color:silver">Không</span>
          </mat-cell>
        </ng-container>

        <ng-container matColumnDef="os">
          <mat-header-cell *matHeaderCellDef>Hệ điều hành</mat-header-cell>
          <mat-cell *matCellDef="let element">

            <i *ngIf="element.os?.name === 'Windows'" class="fab fa-windows"></i>
            <i *ngIf="element.os?.name === 'iOS'" class="fab fa-apple"></i>
            <i *ngIf="element.os?.name === 'Android'" class="fab fa-android"></i>
            <i *ngIf="element.os?.name === 'Mac OS'" class="fab fa-apple"></i>
            <i *ngIf="element.os?.name === 'Linux'" class="fab fa-linux"></i>
            <i *ngIf="element.os?.name === 'Ubuntu'" class="fab fa-ubuntu"></i>

            {{(element.os?.name || 'Unknown') + ' ' + (element.os?.version || '')}}
          </mat-cell>
        </ng-container>

        <ng-container matColumnDef="browser">
          <mat-header-cell *matHeaderCellDef>Trình duyệt</mat-header-cell>
          <mat-cell *matCellDef="let element">

            <i *ngIf="element.browser?.name === 'Edge'" class="fab fa-edge"></i>
            <i *ngIf="element.browser?.name === 'Firefox'" class="fab fa-firefox-browser"></i>
            <i *ngIf="element.browser?.name === 'Chrome' || element.browser?.name === 'Cốc Cốc'"
              class="fab fa-chrome"></i>
            <i *ngIf="element.browser?.name === 'Chromium'" class="fab fa-chrome chromium-icon"></i>
            <i *ngIf="element.browser?.name === 'Safari' || element.browser?.name === 'Mobile Safari'"
              class="fab fa-safari"></i>
            <i *ngIf="element.browser?.name === 'IE'" class="fab fa-internet-explorer"></i>
            <i *ngIf="element.browser?.name === 'Cốc Cốc'" class="fab fa-chrome"></i>
            <i *ngIf="element.browser?.name === 'Opera'" class="fab fa-opera"></i>

            {{(element.browser?.name || 'Unknown') + ' ' + (element.browser?.version || '')}}
          </mat-cell>
        </ng-container>



        <ng-container matColumnDef="network">
          <mat-header-cell *matHeaderCellDef> Mạng </mat-header-cell>
          <mat-cell *matCellDef="let element">{{element.networkCompany?.name || 'Unknown'}}</mat-cell>
        </ng-container>

        <ng-container matColumnDef="location">
          <mat-header-cell *matHeaderCellDef> Tại (địa điểm) </mat-header-cell>
          <mat-cell *matCellDef="let element"> {{element.location?.city || 'Unknown'}}
          </mat-cell>
        </ng-container>

        <ng-container matColumnDef="keyword">
          <mat-header-cell *matHeaderCellDef> Từ khóa </mat-header-cell>
          <mat-cell *matCellDef="let element"> {{element.keyword || ''}}
          </mat-cell>
        </ng-container>

        <ng-container matColumnDef="campaignType">
          <mat-header-cell *matHeaderCellDef> Chiến dịch </mat-header-cell>
          <mat-cell *matCellDef="let element"> {{element.campaignType || ''}}
          </mat-cell>
        </ng-container>

        <ng-container matColumnDef="matchType">
          <mat-header-cell *matHeaderCellDef> Đối sánh </mat-header-cell>
          <mat-cell *matCellDef="let element"> {{element.matchType || ''}}
          </mat-cell>
        </ng-container>

        <ng-container matColumnDef="page">
          <mat-header-cell *matHeaderCellDef> Trang </mat-header-cell>
          <mat-cell *matCellDef="let element"> {{element.page || ''}}
          </mat-cell>
        </ng-container>

        <ng-container matColumnDef="position">
          <mat-header-cell *matHeaderCellDef> Vị trí </mat-header-cell>
          <mat-cell *matCellDef="let element"> {{element.position || ''}}
          </mat-cell>
        </ng-container>

        <mat-header-row *matHeaderRowDef="displayedColumns; sticky: true"></mat-header-row>
        <mat-row *matRowDef="let row; columns: displayedColumns;"></mat-row>
      </mat-table>
    </div>

    <div class="pagination-buttons" fxLayout="row" fxLayout.xs="column" *ngIf="pageTotal !== 1">
      <p *ngIf="pageTotal > 0">Trang <span [(ngModel)]="currentPageNumber"
          ngDefaultControl>{{currentPageNumber === 0 || currentPageNumber === undefined ? 1 : currentPageNumber}}</span>
        trong tổng
        {{pageTotal}} trang</p>
      <p *ngIf="pageTotal === 0 && !isProcessing">Chưa có ghi nhận nào.</p>
      <pagination-controls (pageChange)="changePage($event); currentPageNumber = $event" previousLabel="Trước"
        nextLabel="Sau" fxFlex fxLayoutAlign="end start" *ngIf="pageTotal > 0"></pagination-controls>
    </div>
  </div>

</div>