<div class="container">

  <div class="title1" fxLayout="row" fxLayout.xs="column" fxLayoutAlign="start start" fxLayoutAlign.xs="center start"
    fxLayoutGap="50px" fxLayoutGap.xs="10px">
    <div class="main-title" fxFlex="75">
      THEO DÕI IP ĐANG CLICK QUẢNG CÁO - TÀI KHOẢN <span class="adsId">{{sessionService.activeAdsAccountId}}</span>
    </div>
    <div class="no-website-notify" *ngIf="hasWebsite === false">
      Không tìm thấy website nào.
    </div>

    <mat-form-field class="website-selection" *ngIf="hasWebsite === true">
      <mat-label style="color: white; font-weight: bold">Thống kê theo</mat-label>
      <mat-select [formControl]="websiteCtrl" #singleSelect (selectionChange)="selectWebsite()"
        [disabled]="isProcessing === true">
        <mat-option>
          <ngx-mat-select-search [formControl]="websiteFilterCtrl" [placeholderLabel]="'Tìm kiếm'"
            [noEntriesFoundLabel]="'Không tìm thấy website nào'"></ngx-mat-select-search>
        </mat-option>
        <mat-option *ngFor="let website of filteredWebsites | async" [value]="website">
          {{website.name}}
        </mat-option>
      </mat-select>
    </mat-form-field>

  </div>

  <div class="inner">

    <div class="statistic" fxLayout="row" fxLayout.xs="column" fxLayoutGap="15px" fxLayoutGap.xs="10px">
      <div class="section total" fxFlex="33.33" fxLayout="row" fxLayoutAlign="start center">
        <div fxFlex="20">
          <mat-icon>touch_app</mat-icon>
        </div>
        <div fxLayout="column" fxFlex="80">
          <div class="number">{{abbreviateNumber(clickTotal || 0)}}</div>
          <div class="title">Tổng số click</div>
        </div>
      </div>
      <div fxFlex="66.66" fxLayout="row" fxLayoutGap="15px" fxLayoutGap.xs="10px" fxLayoutAlign="start center">
        <div class="section real-click" fxFlex="50">
          <mat-icon fxFlex="20" fxFlex.xs="25">check_circle</mat-icon>
          <div fxFlex="80" fxFlex.xs="75">
            <div class="number">{{abbreviateNumber(realClick || 0)}}</div>
            <div class="title">Click thật</div>
          </div>
        </div>
        <div class="section spam-click" fxFlex="50">
          <mat-icon fxFlex="20" fxFlex.xs="25">not_interested</mat-icon>
          <div fxFlex="80" fxFlex.xs="75">
            <div class="number">{{abbreviateNumber(spamClick || 0)}}</div>
            <div class="title">Click ảo</div>
          </div>
        </div>
      </div>
    </div>

    <div class="pagination-table-wrapper">
      <div class="table-wrapper">

        <mat-table
          [dataSource]="dataSource | paginate: { itemsPerPage: pageLimit, currentPage: currentPageNumber, totalItems: totalItems }"
          class="mat-elevation-z8">

          <ng-container matColumnDef="time">
            <mat-header-cell *matHeaderCellDef> Thời gian </mat-header-cell>
            <mat-cell *matCellDef="let element"> {{element.info[0].createdAt | date: 'HH:mm dd/MM/yyyy'}} </mat-cell>
          </ng-container>

          <ng-container matColumnDef="ip">
            <mat-header-cell *matHeaderCellDef> IP </mat-header-cell>
            <mat-cell *matCellDef="let element">

              <a matTooltip="Nhấn vào để xem chi tiết" [routerLink]="['/bao-cao/chi-tiet-ip', element._id, router.url]"
                class="ip-detail-link" mat-button color="accent">
                <span *ngIf="element.info[0].isSpam === true" style="color: crimson">{{element._id}}</span>
                <span *ngIf="element.info[0].isSpam === false" style="color: green">{{element._id}}</span>
              </a>

            </mat-cell>
          </ng-container>

          <ng-container matColumnDef="clicks">
            <mat-header-cell *matHeaderCellDef> Lần click </mat-header-cell>
            <mat-cell *matCellDef="let element"> {{element.click}} </mat-cell>
          </ng-container>

          <ng-container matColumnDef="status">
            <mat-header-cell *matHeaderCellDef> Nhận diện </mat-header-cell>
            <mat-cell *matCellDef="let element">
              <span *ngIf="element.info[0].isSpam === true" style="color: crimson; font-weight: bold"
                (mouseover)="showReason(element.info[0].reason || '')">
                <mat-icon>not_interested</mat-icon> Đã chặn
              </span>
              <span *ngIf="element.info[0].isSpam === false" style="color: green; font-weight: bold"
                (mouseover)="showReason(element.info[0].reason || '')">
                <mat-icon>check_circle</mat-icon> Hợp lệ
              </span>
            </mat-cell>
          </ng-container>

          <ng-container matColumnDef="location">
            <mat-header-cell *matHeaderCellDef> Tại (địa điểm) </mat-header-cell>
            <mat-cell *matCellDef="let element">
              {{element.info[0].location?.city || 'Unknown' }} </mat-cell>
          </ng-container>

          <ng-container matColumnDef="os">
            <mat-header-cell *matHeaderCellDef> Hệ điều hành </mat-header-cell>
            <mat-cell *matCellDef="let element">

              <i *ngIf="element.info[0].os?.name === 'Windows'" class="fab fa-windows"></i>
              <i *ngIf="element.info[0].os?.name === 'iOS'" class="fab fa-apple"></i>
              <i *ngIf="element.info[0].os?.name === 'Android'" class="fab fa-android"></i>
              <i *ngIf="element.info[0].os?.name === 'Mac OS'" class="fab fa-apple"></i>
              <i *ngIf="element.info[0].os?.name === 'Linux'" class="fab fa-linux"></i>
              <i *ngIf="element.info[0].os?.name === 'Ubuntu'" class="fab fa-ubuntu"></i>

              {{(element.info[0].os?.name || 'Unknown') + ' ' + (element.info[0].os?.version || '')}}
            </mat-cell>
          </ng-container>

          <ng-container matColumnDef="browser">
            <mat-header-cell *matHeaderCellDef> Trình duyệt </mat-header-cell>
            <mat-cell *matCellDef="let element">
              
              <i *ngIf="element.info[0].browser?.name === 'Edge'" class="fab fa-edge"></i>
              <i *ngIf="element.info[0].browser?.name === 'Firefox'" class="fab fa-firefox-browser"></i>
              <i *ngIf="element.info[0].browser?.name === 'Chrome' || element.browser?.name === 'Cốc Cốc'"
                class="fab fa-chrome"></i>
              <i *ngIf="element.info[0].browser?.name === 'Chromium'" class="fab fa-chrome chromium-icon"></i>
              <i *ngIf="element.info[0].browser?.name === 'Safari' || element.browser?.name === 'Mobile Safari'"
                class="fab fa-safari"></i>
              <i *ngIf="element.info[0].browser?.name === 'IE'" class="fab fa-internet-explorer"></i>
              <i *ngIf="element.info[0].browser?.name === 'Cốc Cốc'" class="fab fa-chrome"></i>
              <i *ngIf="element.info[0].browser?.name === 'Opera'" class="fab fa-opera"></i>

              {{(element.info[0].browser?.name || 'Unknown') + ' ' + (element.info[0].browser?.version || '')}}
            </mat-cell>
          </ng-container>

          <ng-container matColumnDef="isPrivateBrowsing">
            <mat-header-cell *matHeaderCellDef> Ẩn danh </mat-header-cell>
            <mat-cell *matCellDef="let element">
              <span *ngIf="element.info[0].isPrivateBrowsing === true" style="color: orange; font-weight: bold">
                <mat-icon>report_problem</mat-icon>Có
              </span>
              <span *ngIf="element.info[0].isPrivateBrowsing === false" style="color:silver">Không</span>
            </mat-cell>
          </ng-container>

          <ng-container matColumnDef="network">
            <mat-header-cell *matHeaderCellDef> Mạng </mat-header-cell>
            <mat-cell *matCellDef="let element"> {{element.info[0].networkCompany?.name || 'Unknown'}} </mat-cell>
          </ng-container>

          <ng-container matColumnDef="keyword">
            <mat-header-cell *matHeaderCellDef> Từ khóa </mat-header-cell>
            <mat-cell *matCellDef="let element"> {{element.info[0].keyword || ''}}
            </mat-cell>
          </ng-container>

          <ng-container matColumnDef="campaignType">
            <mat-header-cell *matHeaderCellDef> Chiến dịch </mat-header-cell>
            <mat-cell *matCellDef="let element"> {{element.info[0].campaignType || ''}}
            </mat-cell>
          </ng-container>

          <ng-container matColumnDef="matchType">
            <mat-header-cell *matHeaderCellDef> Đối sánh </mat-header-cell>
            <mat-cell *matCellDef="let element"> {{element.info[0].matchType || ''}}
            </mat-cell>
          </ng-container>

          <ng-container matColumnDef="page">
            <mat-header-cell *matHeaderCellDef> Trang </mat-header-cell>
            <mat-cell *matCellDef="let element"> {{element.info[0].page || ''}}
            </mat-cell>
          </ng-container>

          <ng-container matColumnDef="position">
            <mat-header-cell *matHeaderCellDef> Vị trí </mat-header-cell>
            <mat-cell *matCellDef="let element"> {{element.info[0].position || ''}}
            </mat-cell>
          </ng-container>

          <mat-header-row *matHeaderRowDef="displayedColumns; sticky: true"></mat-header-row>
          <mat-row *matRowDef="let row; columns: displayedColumns;"></mat-row>

        </mat-table>

      </div>

      <div class="pagination-buttons" fxLayout="row" fxLayout.xs="column" *ngIf="pageTotal !== 1">
        <p *ngIf="pageTotal > 0">Trang <span [(ngModel)]="currentPageNumber"
            ngDefaultControl>{{currentPageNumber === undefined ? 1 : currentPageNumber}}</span> trong tổng
          {{pageTotal}} trang</p>
        <p *ngIf="pageTotal === 0 && isProcessing === false">Chưa có ghi nhận nào.</p>
        <pagination-controls (pageChange)="changePage($event); currentPageNumber = $event" previousLabel="Trước"
          nextLabel="Sau" fxFlex fxLayoutAlign="end start" *ngIf="pageTotal > 0"></pagination-controls>
      </div>
    </div>

    <div class="footer">
      <p>
        Để theo dõi hành vi click quảng cáo của một IP, Bạn có thể tiến hành gắn mã tracking cho các website của tài
        khoản Google Ads <a [routerLink]="['/gan-tracking/website', sessionService.activeAccountId]">tại đây</a>
      </p>
      <div class="button-area" fxLayout="row" fxLayout.xs="column" fxLayoutGap="15px" fxLayoutAlign="center center">
        <a [routerLink]="'/bao-cao/click-ao'" mat-raised-button color="warn">
          <mat-icon>data_usage</mat-icon> XEM BÁO CÁO CLICK ẢO
        </a>
      </div>
    </div>
  </div>

</div>